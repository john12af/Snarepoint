<!doctype html>
<html lang="en"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>X App Feed - Google Login Fix</title> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"> 
  
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    /* AAPKA PURA 1000+ LINE KA CSS YAHAN RAHEGA (WAISE HI RAKHEIN) */
    /* ... (CSS same as before) ... */
    
    /* Just ensuring the button looks right */
    .google-button {
        width: 100%; max-width: 300px; padding: 14px 20px;
        background: white; border: 1px solid #cfd9de;
        border-radius: 20px; font-size: 15px; font-weight: 500;
        cursor: pointer; display: flex; align-items: center;
        justify-content: center; gap: 12px; margin: 0 auto;
    }
    .google-button img { width: 18px; height: 18px; }
  </style>
 </head> 
 <body> 

  <div class="signin-page" id="signin-page">
     <button class="close-signin" onclick="closeSignIn()"><i class="fas fa-arrow-left"></i></button>
     <div class="signin-logo">X</div>
     <div class="signin-container">
        <div class="signin-title">Sign in to X</div>
        <div class="signin-subtitle">to continue to X App Feed</div>
        
        <button class="google-button" onclick="loginWithGoogle()">
           <img src="https://www.google.com/favicon.ico" alt="Google"> 
           Continue with Google
        </button>
     </div>
  </div>

  <script>
    const CLIENT_ID = "475953482378-otakvj2na9ji5u50npdq2qqk6sttcnhu.apps.googleusercontent.com";
    let tokenClient;
    let isSignedIn = false;
    let userData = null;

    // 1. Initialize logic for Spck/Local Editor
    window.onload = function () {
        // Token Client initialization (Spck ke liye behtar hai)
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID,
            scope: 'https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email',
            callback: (tokenResponse) => {
                if (tokenResponse && tokenResponse.access_token) {
                    // Token milne ke baad user info fetch karna
                    fetchUserInfo(tokenResponse.access_token);
                }
            },
        });
    };

    // 2. Button Click Function
    function loginWithGoogle() {
        try {
            // Yeh popup trigger karega
            tokenClient.requestAccessToken({prompt: 'consent'});
        } catch (err) {
            console.error("Login Error:", err);
            alert("Please use a real browser or host the site to use Google Login.");
        }
    }

    // 3. Fetch User Data using Access Token
    async function fetchUserInfo(accessToken) {
        try {
            const resp = await fetch(`https://www.googleapis.com/oauth2/v3/userinfo?access_token=${accessToken}`);
            const data = await resp.json();
            
            userData = {
                name: data.name,
                picture: data.picture,
                handle: "@" + data.email.split('@')[0]
            };
            
            isSignedIn = true;
            updateProfileUI();
            closeSignIn();
            alert("Welcome " + userData.name + "!");
        } catch (err) {
            console.error("User Info Fetch Error:", err);
        }
    }

    function updateProfileUI() {
        if(!userData) return;
        document.getElementById('header-p-btn').style.backgroundImage = `url('${userData.picture}')`;
        document.getElementById('main-p-avatar').style.backgroundImage = `url('${userData.picture}')`;
        document.getElementById('main-p-name').textContent = userData.name;
        document.getElementById('main-p-handle').textContent = userData.handle;
        document.getElementById('avatar-preview').style.backgroundImage = `url('${userData.picture}')`;
        document.getElementById('edit-name').value = userData.name;
        document.getElementById('edit-username').value = userData.handle;
    }

    // --- AAPKA BAKI ORIGINAL JAVASCRIPT ---
    function toggleSidebar() { /* same */ }
    function openProfile() { /* same */ }
    function closeSignIn() { document.getElementById('signin-page').classList.remove('active'); }
    // ... baki functions waise hi rakhein ...
  </script> 
 </body>
</html>
